# iNovel 作品模块、个人中心、作者中心和数据统计整合文档

## 整合概述

本次整合将原 iNovel 项目中的以下模块成功集成到 merged 项目中:

- ✅ 作品管理模块
- ✅ 个人中心模块
- ✅ 作者中心模块
- ✅ 数据统计模块

## 一、后端整合内容

### 1. 新增实体类 (Entity)

#### 1.1 Work.java - 作品实体

位置: `merged-backend/src/main/java/com/inovel/entity/Work.java`

对应数据库表: `works`

主要字段:

- id: 作品 ID
- title: 作品标题
- cover: 封面图片
- category: 分类
- description: 简介
- authorId: 作者 ID
- authorName: 作者名称
- status: 状态 (0-草稿, 1-连载中, 2-已完结)
- wordCount: 字数统计
- viewCount/likeCount/collectCount: 浏览/点赞/收藏数

#### 1.2 Chapter.java - 章节实体

位置: `merged-backend/src/main/java/com/inovel/entity/Chapter.java`

对应数据库表: `chapters`

主要字段:

- id: 章节 ID
- workId: 所属作品 ID
- chapterNum: 章节序号
- title: 章节标题
- content: 章节内容
- wordCount: 字数

#### 1.3 AuthorStats.java - 作者统计实体

位置: `merged-backend/src/main/java/com/inovel/entity/AuthorStats.java`

统计维度:

- 总作品数、总字数、总浏览量
- 点赞数、收藏数、粉丝数
- 今日/本周/本月浏览量

### 2. 数据访问层 (Mapper)

#### 2.1 WorkMapper.java

位置: `merged-backend/src/main/java/com/inovel/mapper/WorkMapper.java`
XML 配置: `merged-backend/src/main/resources/mapper/WorkMapper.xml`

主要方法:

- selectById: 根据 ID 查询作品
- selectByAuthorId: 查询作者的所有作品
- selectByCategory: 按分类查询
- search: 搜索作品
- insert/update/delete: 增删改操作
- updateViewCount/LikeCount/CollectCount: 更新统计数据

#### 2.2 ChapterMapper.java

位置: `merged-backend/src/main/java/com/inovel/mapper/ChapterMapper.java`
XML 配置: `merged-backend/src/main/resources/mapper/ChapterMapper.xml`

主要方法:

- selectByWorkId: 查询作品的所有章节
- selectByWorkIdAndChapterNum: 按章节号查询
- sumWordCountByWorkId: 统计作品总字数

#### 2.3 AuthorStatsMapper.java

位置: `merged-backend/src/main/java/com/inovel/mapper/AuthorStatsMapper.java`
XML 配置: `merged-backend/src/main/resources/mapper/AuthorStatsMapper.xml`

主要方法:

- getAuthorStats: 获取作者综合统计
- getTodayViews/getWeekViews/getMonthViews: 时间维度统计

### 3. 业务逻辑层 (Service)

#### 3.1 WorkService & WorkServiceImpl

位置:

- `merged-backend/src/main/java/com/inovel/service/WorkService.java`
- `merged-backend/src/main/java/com/inovel/service/impl/WorkServiceImpl.java`

核心功能:

- 作品 CRUD 操作
- 浏览量/点赞/收藏统计
- 作品搜索和分类查询

#### 3.2 ChapterService & ChapterServiceImpl

位置:

- `merged-backend/src/main/java/com/inovel/service/ChapterService.java`
- `merged-backend/src/main/java/com/inovel/service/impl/ChapterServiceImpl.java`

核心功能:

- 章节 CRUD 操作
- 自动计算字数
- 章节浏览量统计

#### 3.3 AuthorStatsService & AuthorStatsServiceImpl

位置:

- `merged-backend/src/main/java/com/inovel/service/AuthorStatsService.java`
- `merged-backend/src/main/java/com/inovel/service/impl/AuthorStatsServiceImpl.java`

核心功能:

- 获取作者综合数据统计
- 多维度时间统计

### 4. 控制器层 (Controller)

#### 4.1 WorkController.java

位置: `merged-backend/src/main/java/com/inovel/controller/WorkController.java`

API 端点:

```
GET    /api/work/{id}              - 获取作品详情
GET    /api/work/author/{authorId} - 获取作者的所有作品
GET    /api/work/list              - 获取所有作品
GET    /api/work/category/{category} - 按分类查询
GET    /api/work/search?keyword=   - 搜索作品
POST   /api/work                   - 创建作品
PUT    /api/work/{id}              - 更新作品
DELETE /api/work/{id}              - 删除作品
POST   /api/work/{id}/view         - 增加浏览量
POST   /api/work/{id}/like         - 点赞
POST   /api/work/{id}/collect      - 收藏
```

#### 4.2 ChapterController.java

位置: `merged-backend/src/main/java/com/inovel/controller/ChapterController.java`

API 端点:

```
GET    /api/chapter/{id}                      - 获取章节详情
GET    /api/chapter/work/{workId}             - 获取作品的所有章节
GET    /api/chapter/work/{workId}/num/{num}   - 按章节号获取
POST   /api/chapter                           - 创建章节
PUT    /api/chapter/{id}                      - 更新章节
DELETE /api/chapter/{id}                      - 删除章节
```

#### 4.3 AuthorController.java

位置: `merged-backend/src/main/java/com/inovel/controller/AuthorController.java`

API 端点:

```
GET    /api/author/{authorId}/stats - 获取作者统计数据
```

#### 4.4 PageController.java

位置: `merged-backend/src/main/java/com/inovel/controller/PageController.java`

页面路由:

```
GET    /user-center   - 个人中心页面
GET    /author-center - 作者中心页面
```

### 5. 数据库 Schema

位置: `merged-backend/src/main/resources/schema-works.sql`

新增数据表:

1. **works** - 作品表
2. **chapters** - 章节表
3. **author_fans** - 作者粉丝关系表
4. **user_work_collect** - 用户收藏作品表
5. **user_work_like** - 用户点赞作品表

User 表扩展字段:

- is_author: 是否为作者
- author_intro: 作者简介
- author_level: 作者等级

## 二、前端整合内容

### 1. Vue 组件

#### 1.1 UserCenter.vue - 个人中心

位置: `merged-frontend/src/views/UserCenter.vue`

功能模块:

- 用户信息展示与编辑
- 我的书架
- 我的收藏
- 阅读历史
- 我的笔记

#### 1.2 AuthorCenter.vue - 作者中心

位置: `merged-frontend/src/views/AuthorCenter.vue`

功能模块:

- 数据统计看板 (作品数、字数、浏览量、粉丝数)
- 我的作品管理
- 数据分析图表
- 读者互动
- 创建/编辑作品
- 章节管理

### 2. 路由配置

位置: `merged-frontend/src/router/index.js`

新增路由:

```javascript
{ path: '/user-center', component: UserCenter, meta: { requiresAuth: true } }
{ path: '/author-center', component: AuthorCenter, meta: { requiresAuth: true } }
```

### 3. Thymeleaf 模板

位置: `merged-backend/src/main/resources/templates/`

复制的 HTML 模板:

- user-center.html - 个人中心静态页面
- author-center.html - 作者中心静态页面

## 三、使用指南

### 1. 数据库初始化

```sql
-- 执行schema文件创建表结构
mysql -u root -p inovel < merged-backend/src/main/resources/schema-works.sql
```

### 2. 启动后端服务

```bash
cd merged-backend
mvn spring-boot:run
```

后端服务将运行在: `http://localhost:8080`

### 3. 启动前端服务

```bash
cd merged-frontend
npm install
npm run dev
```

前端服务将运行在: `http://localhost:5173`

### 4. 访问页面

- 个人中心: `http://localhost:5173/user-center`
- 作者中心: `http://localhost:5173/author-center`

## 四、API 调用示例

### 1. 创建作品

```javascript
const createWork = async () => {
  const response = await fetch("http://localhost:8080/api/work", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + token,
    },
    body: JSON.stringify({
      title: "我的小说",
      category: "玄幻",
      description: "这是一部精彩的小说",
      authorId: 1,
      authorName: "作者名",
      status: 1,
    }),
  });
  const result = await response.json();
};
```

### 2. 获取作者统计数据

```javascript
const getAuthorStats = async (authorId) => {
  const response = await fetch(
    `http://localhost:8080/api/author/${authorId}/stats`
  );
  const result = await response.json();
  console.log(result.data); // { totalWorks, totalWords, totalViews, ... }
};
```

### 3. 创建章节

```javascript
const createChapter = async (workId) => {
  const response = await fetch("http://localhost:8080/api/chapter", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + token,
    },
    body: JSON.stringify({
      workId: workId,
      chapterNum: 1,
      title: "第一章",
      content: "章节内容...",
    }),
  });
  const result = await response.json();
};
```

## 五、技术栈

### 后端

- Spring Boot 3.5.6
- MyBatis 3.0.5
- MySQL 8.0
- Lombok
- JWT 认证

### 前端

- Vue 3
- Vue Router
- Tailwind CSS
- Axios

## 六、后续优化建议

1. **文件上传**: 添加作品封面上传功能
2. **富文本编辑**: 集成富文本编辑器用于章节创建
3. **数据缓存**: 使用 Redis 缓存热门作品和统计数据
4. **搜索优化**: 集成 Elasticsearch 提升搜索性能
5. **消息通知**: 添加作品更新、评论回复等通知功能
6. **权限控制**: 完善作者权限验证和内容审核机制
7. **数据导出**: 支持作品数据导出为 Word/PDF 格式

## 七、注意事项

1. 确保 MySQL 数据库已创建 `inovel` 数据库
2. 修改 `application.yml` 中的数据库连接信息
3. 首次运行需要执行 SQL 脚本初始化表结构
4. 前端需要配置正确的后端 API 地址
5. 使用 JWT 认证时需要在请求头中携带 token

---

整合完成时间: 2025 年 10 月 13 日
整合人员: GitHub Copilot
项目版本: v1.0.0
